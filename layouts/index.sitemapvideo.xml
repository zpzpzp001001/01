{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:video="http://www.google.com/schemas/sitemap-video/1.1">
    <!-- Video sitemap for netfilesnext.com - Last updated: {{ now.Format "2006-01-02T15:04:05-07:00" }} -->
    
    {{ $videoPages := where .Site.RegularPages "Params.video_url" "!=" nil }}
    {{ $youtubePages := where .Site.RegularPages "Params.youtube_id" "!=" nil }}
    {{ $videoFilePages := where .Site.RegularPages "Params.video_file" "!=" nil }}
    {{ $allVideoPages := $videoPages | append $youtubePages | append $videoFilePages }}
    {{ $hasVideoContent := gt (len $allVideoPages) 0 }}
    
    {{ if $hasVideoContent }}
        {{ range .Site.RegularPages }}
            {{ if and (not .Params.private) (or .Params.video_url .Params.youtube_id .Params.video_file) }}
    <url>
        <loc>{{ .Permalink }}</loc>
        <lastmod>{{ .Lastmod.Format "2006-01-02T15:04:05-07:00" }}</lastmod>
        <video:video>
            {{ if .Params.video_thumbnail }}
            <video:thumbnail_loc>{{ .Params.video_thumbnail | absURL }}</video:thumbnail_loc>
            {{ else if .Params.images }}
            <video:thumbnail_loc>{{ index .Params.images 0 | absURL }}</video:thumbnail_loc>
            {{ end }}
            
            <video:title>{{ .Title }}</video:title>
            
            {{ if .Description }}
            <video:description>{{ .Description | truncate 2048 }}</video:description>
            {{ else }}
            <video:description>{{ .Summary | plainify | truncate 2048 }}</video:description>
            {{ end }}
            
            {{ if .Params.video_url }}
            <video:content_loc>{{ .Params.video_url }}</video:content_loc>
            {{ else if .Params.youtube_id }}
            <video:player_loc>https://www.youtube.com/embed/{{ .Params.youtube_id }}</video:player_loc>
            {{ else if .Params.video_file }}
            <video:content_loc>{{ .Params.video_file | absURL }}</video:content_loc>
            {{ end }}
            
            {{ if .Params.video_duration }}
            <video:duration>{{ .Params.video_duration }}</video:duration>
            {{ end }}
            
            <video:publication_date>{{ .Date.Format "2006-01-02T15:04:05-07:00" }}</video:publication_date>
            
            {{ if .Params.tags }}
            <video:tag>{{ delimit .Params.tags ", " }}</video:tag>
            {{ end }}
            
            <video:category>{{ .Section | title }}</video:category>
            <video:family_friendly>yes</video:family_friendly>
            <video:live>no</video:live>
        </video:video>
    </url>
            {{ end }}
        {{ end }}
    {{ end }}
    
    <!-- Always ensure at least one URL entry exists -->
    {{ if not $hasVideoContent }}
    <url>
        <loc>{{ .Site.BaseURL }}</loc>
        <lastmod>{{ now.Format "2006-01-02T15:04:05-07:00" }}</lastmod>
        <changefreq>daily</changefreq>
        <priority>1.0</priority>
    </url>
    {{ end }}
</urlset> 